<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Content Studio - TikTok Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #121212; color: #e5e7eb; }
        .control-card { background: #1f2937; border: 1px solid #374151; }
        .btn-primary { @apply w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-all duration-300 shadow-lg hover:shadow-indigo-500/50 transform hover:-translate-y-0.5; }
        .btn-secondary { @apply w-full bg-gray-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-700 transition-all duration-300 shadow-lg; }
        .btn-tertiary { @apply w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-all duration-300 shadow-lg; }
        button:disabled { @apply bg-gray-500 cursor-not-allowed shadow-none transform-none hover:bg-gray-500; }
        input, select { @apply bg-gray-700 border-gray-600 text-white placeholder-gray-400; }
        input[type="radio"]:checked + label { @apply border-indigo-500 bg-indigo-900/50 text-white; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* TikTok Mockup Styles */
        .mockup-container { background: black; aspect-ratio: 9 / 16.5; max-width: 400px; margin: auto; border-radius: 40px; border: 10px solid #1f2937; box-shadow: 0 0 40px rgba(0,0,0,0.5); position: relative; overflow: hidden; }
        .carousel { width: 100%; height: 100%; position: relative; }
        .carousel-inner { display: flex; height: 100%; transition: transform 0.5s ease-in-out; }
        .carousel-item { min-width: 100%; height: 100%; }
        .carousel-item img { width: 100%; height: 100%; object-cover; }
        .carousel-nav { position: absolute; top: 50%; transform: translateY(-50%); width: 100%; display: flex; justify-content: space-between; padding: 0 10px; pointer-events: none; }
        .carousel-nav button { pointer-events: all; background: rgba(0,0,0,0.4); border-radius: 50%; width: 30px; height: 30px; display:flex; align-items:center; justify-content:center; }
        .carousel-dots { position: absolute; bottom: 130px; left: 50%; transform: translateX(-50%); display: flex; gap: 6px; }
        .carousel-dots span { width: 6px; height: 6px; background: rgba(255,255,255,0.5); border-radius: 50%; transition: all 0.3s; }
        .carousel-dots span.active { background: white; transform: scale(1.2); }
        .mockup-overlay { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: flex-end; background: linear-gradient(to top, rgba(0,0,0,0.7), transparent 40%); padding: 1rem; }
        .mockup-sidebar { position: absolute; right: 10px; bottom: 130px; display: flex; flex-direction: column; align-items: center; gap: 1rem; }
        .sidebar-icon { display: flex; flex-direction: column; align-items: center; font-size: 0.75rem; }
        .spinning-record { width: 40px; height: 40px; background: url('https://placehold.co/40x40/000000/FFFFFF?text=🎵') center center; border-radius: 50%; animation: spin 4s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-12">
            <h1 class="text-5xl font-extrabold text-white">AI Content Studio</h1>
            <p class="text-lg text-gray-400 mt-3">Edisi TikTok FYP</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Kolom Kontrol (Kiri) -->
            <div class="lg:col-span-1 space-y-6">
                 <div class="control-card p-5 rounded-xl">
                    <h2 class="text-xl font-bold mb-3 text-white">Status API</h2>
                    <div class="flex justify-between items-center bg-gray-700 p-3 rounded-lg">
                        <span class="font-semibold text-gray-300">Sisa Kuota (per menit):</span>
                        <div id="apiCreditCounter" class="text-xl font-bold text-indigo-400"></div>
                    </div>
                     <p id="apiTimer" class="text-sm text-center text-gray-400 mt-2"></p>
                </div>

                <div class="control-card p-5 rounded-xl">
                    <h2 class="text-xl font-bold mb-4 text-white flex items-center"><i data-lucide="package" class="mr-2"></i>Langkah 1: Detail Produk</h2>
                    <div class="space-y-4">
                        <input type="text" id="productName" placeholder="Nama Produk" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                        <select id="productType" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                             <option value="" disabled selected>Pilih Jenis Produk</option>
                             <option value="hoodie">Hoodie</option><option value="t-shirt">Kaos</option><option value="jacket">Jaket</option><option value="pants">Celana</option><option value="hat">Topi</option><option value="shoes">Sepatu</option>
                        </select>
                        <input type="file" id="productImage" class="hidden"><label for="productImage" class="flex items-center justify-center w-full p-3 border-2 border-dashed border-gray-600 rounded-lg cursor-pointer hover:bg-gray-700/50"><i data-lucide="upload-cloud" class="mr-2"></i><span id="productImageName">Unggah Produk</span></label>
                        <input type="file" id="faceImage" class="hidden"><label for="faceImage" class="flex items-center justify-center w-full p-3 border-2 border-dashed border-gray-600 rounded-lg cursor-pointer hover:bg-gray-700/50"><i data-lucide="user-scan" class="mr-2"></i><span id="faceImageName">Unggah Wajah</span></label>
                    </div>
                </div>

                <div class="control-card p-5 rounded-xl">
                    <h2 class="text-xl font-bold mb-4 text-white flex items-center"><i data-lucide="camera" class="mr-2"></i>Langkah 2: Konsep Visual</h2>
                    <div class="space-y-4">
                         <div>
                            <label class="font-medium text-gray-300">Model</label>
                            <div class="grid grid-cols-2 gap-2 mt-2">
                                <input type="radio" name="modelGender" value="Pria" id="m1" class="hidden" checked><label for="m1" class="text-center p-2 border border-gray-600 rounded-lg cursor-pointer transition-all">Pria</label>
                                <input type="radio" name="modelGender" value="Wanita" id="m2" class="hidden"><label for="m2" class="text-center p-2 border border-gray-600 rounded-lg cursor-pointer transition-all">Wanita</label>
                            </div>
                        </div>
                        <div>
                            <label class="font-medium text-gray-300">Tema Foto</label>
                             <div class="grid grid-cols-2 gap-2 mt-2">
                                <input type="radio" name="photoConcept" value="Golden Hour Glow" id="c1" class="hidden" checked><label for="c1" class="text-center p-2 border border-gray-600 rounded-lg cursor-pointer transition-all">Golden Hour</label>
                                <input type="radio" name="photoConcept" value="Retro Analog Film" id="c2" class="hidden"><label for="c2" class="text-center p-2 border border-gray-600 rounded-lg cursor-pointer transition-all">Retro Film</label>
                                <input type="radio" name="photoConcept" value="Cyberpunk Nightscape" id="c3" class="hidden"><label for="c3" class="text-center p-2 border border-gray-600 rounded-lg cursor-pointer transition-all">Cyberpunk</label>
                                <input type="radio" name="photoConcept" value="Cozy Coffee Shop" id="c4" class="hidden"><label for="c4" class="text-center p-2 border border-gray-600 rounded-lg cursor-pointer transition-all">Coffee Shop</label>
                                <input type="radio" name="photoConcept" value="Nature Explorer" id="c5" class="hidden"><label for="c5" class="text-center p-2 border border-gray-600 rounded-lg cursor-pointer transition-all">Alam</label>
                                <input type="radio" name="photoConcept" value="Studio Minimalis" id="c6" class="hidden"><label for="c6" class="text-center p-2 border border-gray-600 rounded-lg cursor-pointer transition-all">Studio</label>
                            </div>
                        </div>
                        <input type="text" id="customBackground" placeholder="Latar Kustom (Opsional)" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>
                 <div class="grid grid-cols-1 gap-4">
                    <button id="generateImageBtn" class="btn-primary flex items-center justify-center"><i data-lucide="image" class="mr-2"></i>Generate Foto</button>
                    <button id="generateTextBtn" class="btn-tertiary flex items-center justify-center" disabled><i data-lucide="file-text" class="mr-2"></i>Generate Teks</button>
                    <button id="resetBtn" class="btn-secondary flex items-center justify-center"><i data-lucide="rotate-cw" class="mr-2"></i>Mulai Lagi</button>
                </div>
            </div>

            <!-- Kolom Hasil (Kanan) -->
            <div class="lg:col-span-2 space-y-6">
                <div class="mockup-container">
                    <div class="carousel">
                        <div id="carousel-inner" class="carousel-inner">
                            <!-- Placeholder -->
                            <div class="carousel-item flex items-center justify-center bg-gray-900"><div class="text-gray-500 text-center"><i data-lucide="image-off" class="w-24 h-24 mx-auto"></i><p>Hasil Foto Akan Muncul Di Sini</p></div></div>
                        </div>
                    </div>
                    <div id="carousel-nav" class="carousel-nav hidden">
                        <button id="prevBtn"><i data-lucide="chevron-left" class="text-white"></i></button>
                        <button id="nextBtn"><i data-lucide="chevron-right" class="text-white"></i></button>
                    </div>
                    <div id="carousel-dots" class="carousel-dots"></div>

                    <!-- Overlay UI TikTok -->
                    <div class="mockup-overlay">
                        <div class="w-full">
                            <p id="mockupUsername" class="font-bold text-white">@username_produk</p>
                            <p id="mockupCaption" class="text-white text-sm mt-1">Deskripsi & hashtag viral akan muncul di sini setelah Anda generate teks...</p>
                        </div>
                    </div>
                    <div class="mockup-sidebar">
                        <div class="sidebar-icon"><div class="w-12 h-12 bg-gray-500 rounded-full border-2 border-white"></div></div>
                        <div class="sidebar-icon"><i data-lucide="heart" class="w-8 h-8 text-white"></i><span id="mockupLikes">12.3K</span></div>
                        <div class="sidebar-icon"><i data-lucide="message-circle" class="w-8 h-8 text-white"></i><span>123</span></div>
                        <div class="sidebar-icon"><i data-lucide="share-2" class="w-8 h-8 text-white"></i><span>456</span></div>
                        <div class="spinning-record mt-2"></div>
                    </div>
                </div>

                <!-- Hasil Teks & Suara -->
                <div id="textAudioSection" class="space-y-4 hidden fade-in">
                    <div class="control-card p-5 rounded-xl">
                         <div class="relative">
                            <label class="font-semibold text-white">Deskripsi TikTok (Viral)</label>
                            <textarea id="tiktokCaption" rows="4" class="w-full p-3 mt-1 border rounded-lg bg-gray-700 focus:outline-none" readonly></textarea>
                            <button onclick="copyToClipboard('tiktokCaption')" class="absolute top-8 right-2 p-2 rounded-full hover:bg-gray-600 transition-colors"><i data-lucide="copy"></i></button>
                        </div>
                    </div>
                     <div class="control-card p-5 rounded-xl">
                        <div class="relative">
                            <label class="font-semibold text-white">Narasi Video (Persuasif)</label>
                            <textarea id="promoNarrative" rows="5" class="w-full p-3 mt-1 border rounded-lg bg-gray-700 focus:outline-none" readonly></textarea>
                             <button onclick="copyToClipboard('promoNarrative')" class="absolute top-8 right-2 p-2 rounded-full hover:bg-gray-600 transition-colors"><i data-lucide="copy"></i></button>
                        </div>
                        <div id="audioLoader" class="hidden justify-center items-center py-4"><div class="loader"></div></div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <button id="generateMaleAudioBtn" class="bg-blue-500 text-white font-bold p-3 rounded-lg flex items-center justify-center hover:bg-blue-600 transition-all"><i data-lucide="mic" class="mr-2"></i>Suara Pria</button>
                            <button id="generateFemaleAudioBtn" class="bg-pink-500 text-white font-bold p-3 rounded-lg flex items-center justify-center hover:bg-pink-600 transition-all"><i data-lucide="mic" class="mr-2"></i>Suara Wanita</button>
                        </div>
                        <div id="maleAudioContainer" class="hidden mt-3"> <label class="font-medium text-sm">Hasil Suara Pria:</label> <audio controls class="w-full mt-1"></audio> </div>
                        <div id="femaleAudioContainer" class="hidden mt-3"> <label class="font-medium text-sm">Hasil Suara Wanita:</label> <audio controls class="w-full mt-1"></audio> </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    lucide.createIcons();
    // Simplified JS for brevity, the full logic remains the same as the previous full version
    // The core changes are in the HTML and CSS for the new TikTok theme.
    const elements = {
        buttons: { image: getElement('generateImageBtn'), text: getElement('generateTextBtn'), reset: getElement('resetBtn'), maleAudio: getElement('generateMaleAudioBtn'), femaleAudio: getElement('generateFemaleAudioBtn'), prev: getElement('prevBtn'), next: getElement('nextBtn') },
        results: { image: getElement('imageResult'), textAudioSection: getElement('textAudioSection'), tiktokCaption: getElement('tiktokCaption'), promoNarrative: getElement('promoNarrative'), maleAudioContainer: getElement('maleAudioContainer'), femaleAudioContainer: getElement('femaleAudioContainer'), carouselInner: getElement('carousel-inner'), carouselNav: getElement('carousel-nav'), carouselDots: getElement('carousel-dots') },
        loaders: { audio: getElement('audioLoader') },
        inputs: { productName: getElement('productName'), productType: getElement('productType'), productImage: getElement('productImage'), faceImage: getElement('faceImage'), customBackground: getElement('customBackground') },
        displays: { productImageName: getElement('productImageName'), faceImageName: getElement('faceImageName'), creditCounter: getElement('apiCreditCounter'), apiTimer: getElement('apiTimer'), mockupUsername: getElement('mockupUsername'), mockupCaption: getElement('mockupCaption') }
    };
    const RPM_LIMIT = 15;
    let credits = RPM_LIMIT;
    let timerInterval;
    let currentSlide = 0;
    let totalSlides = 0;

    function updateCreditDisplay() { elements.displays.creditCounter.textContent = `${credits} / ${RPM_LIMIT}`; }
    function startApiTimer() { if (timerInterval) clearInterval(timerInterval); let timeLeft = 60; elements.displays.apiTimer.textContent = `Kuota reset dalam ${timeLeft} detik...`; timerInterval = setInterval(() => { timeLeft--; elements.displays.apiTimer.textContent = `Kuota reset dalam ${timeLeft} detik...`; if (timeLeft <= 0) { clearInterval(timerInterval); credits = RPM_LIMIT; updateCreditDisplay(); elements.displays.apiTimer.textContent = 'Kuota telah direset.'; } }, 1000); }
    function useCredit() { if (credits === RPM_LIMIT) { startApiTimer(); } if (credits > 0) { credits--; updateCreditDisplay(); return true; } alert("Kuota per menit telah habis. Harap tunggu."); return false; }
    document.addEventListener('DOMContentLoaded', updateCreditDisplay);
    const API_ROUTE = '/api/generate';
    async function callApi(endpoint, body) { const response = await fetch(endpoint, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) }); if (!response.ok) { const error = await response.json(); throw new Error(error.details || error.error || 'Terjadi kesalahan'); } return response.json(); }
    function fileToBase64(file) { return new Promise((resolve, reject) => { const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = () => resolve(reader.result.split(',')[1]); reader.onerror = error => reject(error); }); }
    function base64ToBlob(base64, mimeType) { const byteCharacters = atob(base64); const byteNumbers = new Array(byteCharacters.length); for (let i = 0; i < byteCharacters.length; i++) { byteNumbers[i] = byteCharacters.charCodeAt(i); } const byteArray = new Uint8Array(byteNumbers); return new Blob([byteArray], {type: mimeType}); }
    function copyToClipboard(elementId) { const textArea = getElement(elementId); textArea.select(); document.execCommand('copy'); alert('Teks berhasil disalin!'); }
    function downloadImage(base64, fileName) { const link = document.createElement('a'); link.href = `data:image/png;base64,${base64}`; link.download = fileName; document.body.appendChild(link); link.click(); document.body.removeChild(link); }
    elements.inputs.productImage.addEventListener('change', function() { elements.displays.productImageName.textContent = this.files.length > 0 ? `✔️ ${this.files[0].name}` : 'Unggah Produk'; });
    elements.inputs.faceImage.addEventListener('change', function() { elements.displays.faceImageName.textContent = this.files.length > 0 ? `✔️ ${this.files[0].name}` : 'Unggah Wajah'; });
    
    // Carousel Functions
    function showSlide(index) {
        elements.results.carouselInner.style.transform = `translateX(-${index * 100}%)`;
        document.querySelectorAll('.carousel-dot').forEach((dot, i) => {
            dot.classList.toggle('active', i === index);
        });
        currentSlide = index;
    }
    elements.buttons.prev.addEventListener('click', () => showSlide(currentSlide > 0 ? currentSlide - 1 : totalSlides - 1));
    elements.buttons.next.addEventListener('click', () => showSlide(currentSlide < totalSlides - 1 ? currentSlide + 1 : 0));

    // Generate Image Logic
    elements.buttons.image.addEventListener('click', async () => {
        if (!useCredit()) return;
        const { productName, productType, productImage } = elements.inputs;
        if (!productName.value || !productType.value || !productImage.files[0]) { alert("Harap isi Nama, Tipe, dan Gambar Produk."); return; }
        elements.buttons.image.disabled = true;
        elements.results.carouselInner.innerHTML = `<div class="carousel-item flex items-center justify-center bg-gray-900"><div class="text-gray-500 text-center"><div class="loader mx-auto"></div><p class="mt-4">AI sedang bekerja...</p></div></div>`;
        try {
            const productImageBase64 = await fileToBase64(productImage.files[0]);
            let faceImageBase64 = null;
            if (elements.inputs.faceImage.files[0]) faceImageBase64 = await fileToBase64(elements.inputs.faceImage.files[0]);
            const payload = { type: 'image', productName: productName.value, productType: productType.value, photoConcept: document.querySelector('input[name="photoConcept"]:checked').value, modelGender: document.querySelector('input[name="modelGender"]:checked').value, customBackground: elements.inputs.customBackground.value, productImage: { base64: productImageBase64, mimeType: productImage.files[0].type }, faceImage: elements.inputs.faceImage.files[0] ? { base64: faceImageBase64, mimeType: elements.inputs.faceImage.files[0].type } : null, };
            const result = await callApi(API_ROUTE, payload);
            if (result.images && result.images.length > 0) {
                elements.results.carouselInner.innerHTML = '';
                elements.results.carouselDots.innerHTML = '';
                totalSlides = result.images.length;
                result.images.forEach((base64, index) => {
                    const item = document.createElement('div');
                    item.className = 'carousel-item';
                    item.innerHTML = `<img src="data:image/png;base64,${base64}" alt="Generated Image ${index + 1}">`;
                    elements.results.carouselInner.appendChild(item);
                    const dot = document.createElement('span');
                    dot.className = 'carousel-dot';
                    dot.onclick = () => showSlide(index);
                    elements.results.carouselDots.appendChild(dot);
                });
                elements.displays.mockupUsername.textContent = `@${productName.value.toLowerCase().replace(/\s+/g, '_')}`;
                elements.results.carouselNav.classList.remove('hidden');
                showSlide(0);
                elements.buttons.text.disabled = false;
            } else { throw new Error(result.error || 'Gagal membuat gambar.'); }
        } catch (error) { elements.results.carouselInner.innerHTML = `<div class="carousel-item flex items-center justify-center bg-gray-900"><p class="text-red-400 p-4 text-center">${error.message}</p></div>`; elements.buttons.image.disabled = false; }
    });
    // Text and Audio Logic
    elements.buttons.text.addEventListener('click', async () => {
         if (!useCredit()) return;
         elements.buttons.text.disabled = true;
         elements.results.textAudioSection.classList.remove('hidden');
         try {
             const result = await callApi(API_ROUTE, { type: 'text', productName: elements.inputs.productName.value });
             elements.results.tiktokCaption.value = result.caption;
             elements.results.promoNarrative.value = result.narrative;
             elements.displays.mockupCaption.textContent = result.caption;
         } catch (error) { alert(`Gagal: ${error.message}`); elements.buttons.text.disabled = false; }
    });
    async function generateAudio(gender) {
        if (!useCredit()) return;
        elements.loaders.audio.style.display = 'flex';
        const container = (gender === 'male') ? elements.results.maleAudioContainer : elements.results.femaleAudioContainer;
        container.classList.add('hidden');
        try {
            const result = await callApi(API_ROUTE, { type: 'audio', gender, narrative: elements.results.promoNarrative.value });
            const blob = base64ToBlob(result.audioData, result.mimeType);
            container.querySelector('audio').src = URL.createObjectURL(blob);
            container.classList.remove('hidden');
        } catch (error) { alert(`Gagal: ${error.message}`); } finally { elements.loaders.audio.style.display = 'none'; }
    }
    elements.buttons.maleAudio.addEventListener('click', () => generateAudio('male'));
    elements.buttons.femaleAudio.addEventListener('click', () => generateAudio('female'));
    elements.buttons.reset.addEventListener('click', () => window.location.reload());
</script>
</body>
</html>


